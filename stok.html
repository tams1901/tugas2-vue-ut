<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stok Bahan Ajar - Universitas Terbuka</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
</head>
<body>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div id="app">
        <header>
            <h1>Sistem Pemesanan Bahan Ajar Universitas Terbuka</h1>
            <nav>
                <a href="index.html" class="nav-link">Home</a>
                <a href="stok.html" class="nav-link active">Stok Bahan Ajar</a>
                <a href="tracking.html" class="nav-link">Tracking DO</a>
            </nav>
            <button class="dark-mode-toggle hidden" id="darkModeToggle">ðŸŒ™</button>
        </header>
        <main>
            <h2>Daftar Stok Bahan Ajar</h2>

            <!-- Filters -->
            <div class="filter-section">
                <h3>Filter dan Sort</h3>
                <div class="form-group">
                    <label>Filter UT-Daerah:</label>
                    <select v-model="filterUpbjj">
                        <option value="">Semua</option>
                        <option v-for="upbjj in upbjjList" :value="upbjj">{{ upbjj }}</option>
                    </select>
                </div>

                <div class="form-group" v-if="filterUpbjj">
                    <label>Filter Kategori:</label>
                    <select v-model="filterKategori">
                        <option value="">Semua</option>
                        <option v-for="kategori in availableKategori" :value="kategori">{{ kategori }}</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" v-model="showLowStock">
                        Tampilkan stok rendah
                    </label>
                </div>

                <div class="sort-buttons">
                    <label>Sort by:</label>
                    <button @click="toggleSort('judul')">Judul {{ sortBy === 'judul' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : '' }}</button>
                    <button @click="toggleSort('qty')">Stock {{ sortBy === 'qty' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : '' }}</button>
                    <button @click="toggleSort('harga')">Harga {{ sortBy === 'harga' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : '' }}</button>
                </div>

                <button @click="resetFilters" class="btn-secondary">Reset Filter</button>
            </div>

            <!-- Table -->
            <table>
                <thead>
                    <tr>
                        <th>Kode / Judul</th>
                        <th>Kategori</th>
                        <th>UT-Daerah</th>
                        <th>Lokasi Rak</th>
                        <th>Qty</th>
                        <th>Safety</th>
                        <th>Status</th>
                        <th>Catatan</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="(item, index) in filteredStok" :key="item.kode">
                        <td>{{ item.kode }}<br><strong>{{ item.judul }}</strong></td>
                        <td>{{ item.kategori }}</td>
                        <td>{{ item.upbjj }}</td>
                        <td>{{ item.lokasiRak }}</td>
                        <td>{{ item.qty }}</td>
                        <td>{{ item.safety }}</td>
                        <td :class="getStatusClass(item)">{{ getStatus(item) }}</td>
                        <td v-html="item.catatanHTML"></td>
                        <td>
                            <button @click="editItem(index)">Edit</button>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Edit Form -->
            <div v-if="editingIndex !== -1">
                <h3>Edit Item</h3>
                <form @submit.prevent="saveEdit">
                    <div class="form-group">
                        <label>Kode:</label>
                        <input v-model="newItem.kode" required>
                        <span v-if="errors.kode" class="error">{{ errors.kode }}</span>
                    </div>
                    <div class="form-group">
                        <label>Judul:</label>
                        <input v-model="newItem.judul" required>
                        <span v-if="errors.judul" class="error">{{ errors.judul }}</span>
                    </div>
                    <div class="form-group">
                        <label>Kategori:</label>
                        <select v-model="newItem.kategori" required>
                            <option value="">Pilih Kategori</option>
                            <option v-for="kategori in kategoriList" :value="kategori">{{ kategori }}</option>
                        </select>
                        <span v-if="errors.kategori" class="error">{{ errors.kategori }}</span>
                    </div>
                    <div class="form-group">
                        <label>UPBJJ:</label>
                        <select v-model="newItem.upbjj" required>
                            <option value="">Pilih UPBJJ</option>
                            <option v-for="upbjj in upbjjList" :value="upbjj">{{ upbjj }}</option>
                        </select>
                        <span v-if="errors.upbjj" class="error">{{ errors.upbjj }}</span>
                    </div>
                    <div class="form-group">
                        <label>Lokasi Rak:</label>
                        <input v-model="newItem.lokasiRak" required>
                        <span v-if="errors.lokasiRak" class="error">{{ errors.lokasiRak }}</span>
                    </div>
                    <div class="form-group">
                        <label>Harga:</label>
                        <input v-model.number="newItem.harga" type="number" min="1" required>
                        <span v-if="errors.harga" class="error">{{ errors.harga }}</span>
                    </div>
                    <div class="form-group">
                        <label>Qty:</label>
                        <input v-model.number="newItem.qty" type="number" min="0" required>
                        <span v-if="errors.qty" class="error">{{ errors.qty }}</span>
                    </div>
                    <div class="form-group">
                        <label>Safety:</label>
                        <input v-model.number="newItem.safety" type="number" min="0" required>
                        <span v-if="errors.safety" class="error">{{ errors.safety }}</span>
                    </div>
                    <div class="form-group">
                        <label>Catatan HTML:</label>
                        <input v-model="newItem.catatanHTML">
                    </div>
                    <button type="submit">Save</button>
                    <button type="button" @click="cancelEdit" class="btn-secondary">Cancel</button>
                </form>
            </div>

            <!-- Add New Item Form -->
            <div>
                <h3>Tambah Item Baru</h3>
                <form @submit.prevent="addItem">
                    <div class="form-group">
                        <label>Kode:</label>
                        <input v-model="newItem.kode" required>
                        <span v-if="errors.kode" class="error">{{ errors.kode }}</span>
                    </div>
                    <div class="form-group">
                        <label>Judul:</label>
                        <input v-model="newItem.judul" required>
                        <span v-if="errors.judul" class="error">{{ errors.judul }}</span>
                    </div>
                    <div class="form-group">
                        <label>Kategori:</label>
                        <select v-model="newItem.kategori" required>
                            <option value="">Pilih Kategori</option>
                            <option v-for="kategori in kategoriList" :value="kategori">{{ kategori }}</option>
                        </select>
                        <span v-if="errors.kategori" class="error">{{ errors.kategori }}</span>
                    </div>
                    <div class="form-group">
                        <label>UPBJJ:</label>
                        <select v-model="newItem.upbjj" required>
                            <option value="">Pilih UPBJJ</option>
                            <option v-for="upbjj in upbjjList" :value="upbjj">{{ upbjj }}</option>
                        </select>
                        <span v-if="errors.upbjj" class="error">{{ errors.upbjj }}</span>
                    </div>
                    <div class="form-group">
                        <label>Lokasi Rak:</label>
                        <input v-model="newItem.lokasiRak" required>
                        <span v-if="errors.lokasiRak" class="error">{{ errors.lokasiRak }}</span>
                    </div>
                    <div class="form-group">
                        <label>Harga:</label>
                        <input v-model.number="newItem.harga" type="number" min="1" required>
                        <span v-if="errors.harga" class="error">{{ errors.harga }}</span>
                    </div>
                    <div class="form-group">
                        <label>Qty:</label>
                        <input v-model.number="newItem.qty" type="number" min="0" required>
                        <span v-if="errors.qty" class="error">{{ errors.qty }}</span>
                    </div>
                    <div class="form-group">
                        <label>Safety:</label>
                        <input v-model.number="newItem.safety" type="number" min="0" required>
                        <span v-if="errors.safety" class="error">{{ errors.safety }}</span>
                    </div>
                    <div class="form-group">
                        <label>Catatan HTML:</label>
                        <input v-model="newItem.catatanHTML">
                    </div>
                    <button type="submit">Tambah</button>
                </form>
            </div>
        </main>
    </div>
    <script src="js/transitions.js"></script>
    <script src="js/stok-app.js"></script>
</body>
</html>
